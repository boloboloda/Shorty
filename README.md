# ğŸ”— Shorty - ç°ä»£åŒ–çŸ­é“¾æ¥æœåŠ¡

[![GitHub license](https://img.shields.io/github/license/yourusername/shorty)](https://github.com/yourusername/shorty/blob/main/LICENSE)
[![GitHub stars](https://img.shields.io/github/stars/yourusername/shorty)](https://github.com/yourusername/shorty/stargazers)
[![GitHub issues](https://img.shields.io/github/issues/yourusername/shorty)](https://github.com/yourusername/shorty/issues)

ä¸€ä¸ªåŸºäº Cloudflare Workers çš„é«˜æ€§èƒ½ã€åŠŸèƒ½ä¸°å¯Œçš„çŸ­é“¾æ¥æœåŠ¡ï¼Œæä¾›å®Œæ•´çš„é“¾æ¥ç®¡ç†ã€è¯¦ç»†åˆ†æå’Œç°ä»£åŒ–ç®¡ç†ç•Œé¢ã€‚

## âœ¨ ä¸»è¦ç‰¹æ€§

### ğŸš€ æ ¸å¿ƒåŠŸèƒ½

- **é«˜æ€§èƒ½çŸ­é“¾æ¥ç”Ÿæˆ** - åŸºäº Cloudflare Workers è¾¹ç¼˜è®¡ç®—
- **è‡ªå®šä¹‰çŸ­ç æ”¯æŒ** - ç”¨æˆ·å¯è‡ªå®šä¹‰é“¾æ¥åç¼€
- **é“¾æ¥è¿‡æœŸç®¡ç†** - æ”¯æŒè®¾ç½®é“¾æ¥æœ‰æ•ˆæœŸ
- **é“¾æ¥çŠ¶æ€æ§åˆ¶** - å¯ç”¨/ç¦ç”¨é“¾æ¥åŠŸèƒ½
- **æ‰¹é‡é“¾æ¥ç®¡ç†** - æ”¯æŒæ‰¹é‡æ“ä½œå’Œç®¡ç†

### ğŸ“Š æ•°æ®åˆ†æ

- **è¯¦ç»†è®¿é—®ç»Ÿè®¡** - IPã€è®¾å¤‡ã€æµè§ˆå™¨ã€åœ°ç†ä½ç½®åˆ†æ
- **å®æ—¶æ•°æ®ç›‘æ§** - è®¿é—®è¶‹åŠ¿ã€çƒ­é—¨é“¾æ¥æ’è¡Œ
- **æ•°æ®å¯¼å‡ºåŠŸèƒ½** - æ”¯æŒ JSON/CSV æ ¼å¼å¯¼å‡º
- **è®¿é—®æ—¥å¿—æŸ¥è¯¢** - å®Œæ•´çš„è®¿é—®è®°å½•å’Œç­›é€‰
- **å¯è§†åŒ–å›¾è¡¨** - Chart.js é©±åŠ¨çš„æ•°æ®å¯è§†åŒ–

### ğŸ¨ ç®¡ç†ç•Œé¢

- **ç°ä»£åŒ–ä»ªè¡¨æ¿** - å“åº”å¼è®¾è®¡ï¼Œç§»åŠ¨ç«¯å‹å¥½
- **å®æ—¶æ•°æ®å±•ç¤º** - ç»Ÿè®¡å¡ç‰‡ã€è¶‹åŠ¿å›¾è¡¨
- **ä¾¿æ·é“¾æ¥ç®¡ç†** - åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤ã€çŠ¶æ€åˆ‡æ¢
- **ä¼˜é›…çš„ç”¨æˆ·ä½“éªŒ** - æµç•…åŠ¨ç”»ã€æ™ºèƒ½æç¤º

### ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

- **URL éªŒè¯å’Œæ¸…ç†** - é˜²æ­¢æ¶æ„é“¾æ¥
- **è®¿é—®é¢‘ç‡é™åˆ¶** - é˜²æ­¢æ»¥ç”¨
- **å®‰å…¨å¤´è®¾ç½®** - CSPã€HSTS ç­‰å®‰å…¨ç­–ç•¥
- **é”™è¯¯å¤„ç†æœºåˆ¶** - ä¼˜é›…çš„é”™è¯¯é¡µé¢

## ğŸ—ï¸ æŠ€æœ¯æ ˆ

### åç«¯æŠ€æœ¯

- **[Cloudflare Workers](https://workers.cloudflare.com/)** - è¾¹ç¼˜è®¡ç®—å¹³å°
- **[Hono](https://hono.dev/)** - è½»é‡çº§ Web æ¡†æ¶
- **[TypeScript](https://www.typescriptlang.org/)** - ç±»å‹å®‰å…¨çš„ JavaScript
- **[Cloudflare D1](https://developers.cloudflare.com/d1/)** - è¾¹ç¼˜ SQLite æ•°æ®åº“
- **[Zod](https://zod.dev/)** - TypeScript ä¼˜å…ˆçš„æ•°æ®éªŒè¯

### å‰ç«¯æŠ€æœ¯

- **åŸç”Ÿ HTML/CSS/JavaScript** - æ— æ¡†æ¶ä¾èµ–
- **[Chart.js](https://www.chartjs.org/)** - æ•°æ®å¯è§†åŒ–
- **å“åº”å¼è®¾è®¡** - é€‚é…æ‰€æœ‰è®¾å¤‡
- **ç°ä»£åŒ– UI** - CSS Gridã€Flexboxã€åŠ¨ç”»æ•ˆæœ

### å¼€å‘å·¥å…·

- **[Wrangler](https://developers.cloudflare.com/workers/wrangler/)** - Cloudflare å¼€å‘å·¥å…·
- **[Vitest](https://vitest.dev/)** - å•å…ƒæµ‹è¯•æ¡†æ¶
- **ESLint + Prettier** - ä»£ç è´¨é‡ä¿è¯

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js 18+
- npm æˆ– yarn
- Cloudflare è´¦æˆ·

### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/yourusername/shorty.git
cd shorty
```

### 2. å®‰è£…ä¾èµ–

```bash
npm install
```

### 3. é…ç½®ç¯å¢ƒ

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
ENVIRONMENT=development
BASE_URL=http://localhost:8787
CORS_ORIGIN=*
DEFAULT_SHORT_LENGTH=6
MAX_URL_LENGTH=2048
RATE_LIMIT_PER_MINUTE=60
```

### 4. åˆ›å»ºæ•°æ®åº“

```bash
# åˆ›å»º D1 æ•°æ®åº“
npx wrangler d1 create shorty-db

# æ‰§è¡Œæ•°æ®åº“è¿ç§»
npx wrangler d1 migrations apply shorty-db --local
```

### 5. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

æœåŠ¡å™¨å°†åœ¨ `http://localhost:8787` å¯åŠ¨ã€‚

### 6. è®¿é—®ç®¡ç†ç•Œé¢

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š

- **ä¸»é¡µ**: http://localhost:8787
- **ç®¡ç†ä»ªè¡¨æ¿**: http://localhost:8787/dashboard

## ğŸ“‹ API æ–‡æ¡£

### é“¾æ¥ç®¡ç† API

#### åˆ›å»ºçŸ­é“¾æ¥

```http
POST /api/links
Content-Type: application/json

{
  "originalUrl": "https://example.com",
  "customSlug": "my-link",  // å¯é€‰
  "expireDays": 365         // å¯é€‰
}
```

#### è·å–é“¾æ¥åˆ—è¡¨

```http
GET /api/links?page=1&limit=10
```

#### è·å–å•ä¸ªé“¾æ¥

```http
GET /api/links/code/{shortCode}
```

#### æ›´æ–°é“¾æ¥

```http
PUT /api/links/code/{shortCode}
Content-Type: application/json

{
  "originalUrl": "https://new-url.com",
  "isActive": true
}
```

#### åˆ é™¤é“¾æ¥

```http
DELETE /api/links/code/{shortCode}
```

#### åˆ‡æ¢é“¾æ¥çŠ¶æ€

```http
POST /api/links/code/{shortCode}/toggle
```

### åˆ†æ API

#### è·å–æ€»ä½“åˆ†æ

```http
GET /api/analytics/overview
```

#### è·å–é“¾æ¥è¯¦ç»†ç»Ÿè®¡

```http
GET /api/analytics/links/code/{shortCode}
```

#### è·å–çƒ­é—¨é“¾æ¥

```http
GET /api/analytics/top-links?period=week&limit=10
```

#### è·å–è®¿é—®æ—¥å¿—

```http
GET /api/analytics/access-logs?shortCode={shortCode}&page=1&limit=20
```

#### æ•°æ®å¯¼å‡º

```http
GET /api/analytics/export?format=csv&startDate=2023-01-01&endDate=2023-12-31
```

### é‡å®šå‘

```http
GET /{shortCode}
# è‡ªåŠ¨é‡å®šå‘åˆ°åŸå§‹URL
```

## ğŸ—„ï¸ æ•°æ®åº“æ¶æ„

### ä¸»è¦æ•°æ®è¡¨

#### `links` - é“¾æ¥åŸºç¡€ä¿¡æ¯

```sql
CREATE TABLE links (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  original_url TEXT NOT NULL,
  short_code TEXT UNIQUE NOT NULL,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  expires_at DATETIME,
  access_count INTEGER DEFAULT 0,
  is_active BOOLEAN DEFAULT TRUE,
  last_accessed_at DATETIME
);
```

#### `access_logs` - è®¿é—®è®°å½•

```sql
CREATE TABLE access_logs (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  link_id INTEGER NOT NULL,
  short_code TEXT NOT NULL,
  accessed_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  ip_address TEXT,
  user_agent TEXT,
  referer TEXT,
  country TEXT,
  city TEXT,
  device_type TEXT,
  browser TEXT,
  os TEXT,
  response_time_ms INTEGER
);
```

#### `daily_stats` - æ¯æ—¥ç»Ÿè®¡

```sql
CREATE TABLE daily_stats (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  link_id INTEGER NOT NULL,
  short_code TEXT NOT NULL,
  date TEXT NOT NULL,
  total_visits INTEGER DEFAULT 0,
  unique_visitors INTEGER DEFAULT 0,
  mobile_visits INTEGER DEFAULT 0,
  desktop_visits INTEGER DEFAULT 0,
  tablet_visits INTEGER DEFAULT 0,
  bot_visits INTEGER DEFAULT 0,
  top_countries TEXT,
  top_cities TEXT,
  top_referers TEXT,
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

## ğŸš€ éƒ¨ç½²æŒ‡å—

### Cloudflare Workers éƒ¨ç½²

#### 1. é…ç½® wrangler.toml

```toml
name = "shorty"
main = "src/index.ts"
compatibility_date = "2024-01-15"
compatibility_flags = ["nodejs_compat"]

[env.production]
vars = { ENVIRONMENT = "production" }

[[env.production.d1_databases]]
binding = "DB"
database_name = "shorty-db"
database_id = "your-database-id"
```

#### 2. åˆ›å»ºç”Ÿäº§æ•°æ®åº“

```bash
# åˆ›å»ºç”Ÿäº§æ•°æ®åº“
npx wrangler d1 create shorty-db-prod

# è¿è¡Œè¿ç§»
npx wrangler d1 migrations apply shorty-db-prod --env production
```

#### 3. éƒ¨ç½²åˆ° Cloudflare

```bash
npm run deploy
```

#### 4. è®¾ç½®è‡ªå®šä¹‰åŸŸå

åœ¨ Cloudflare Workers æ§åˆ¶å°è®¾ç½®è‡ªå®šä¹‰åŸŸåï¼Œå¦‚ `https://short.yourdomain.com`

### ç¯å¢ƒå˜é‡é…ç½®

åœ¨ Cloudflare Workers æ§åˆ¶å°è®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

```env
ENVIRONMENT=production
BASE_URL=https://short.yourdomain.com
CORS_ORIGIN=https://yourdomain.com
DEFAULT_SHORT_LENGTH=6
MAX_URL_LENGTH=2048
RATE_LIMIT_PER_MINUTE=100
```

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
shorty/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ handlers/          # è¯·æ±‚å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ analytics.ts   # åˆ†æAPI
â”‚   â”‚   â”œâ”€â”€ links.ts       # é“¾æ¥ç®¡ç†API
â”‚   â”‚   â””â”€â”€ redirect.ts    # é‡å®šå‘å¤„ç†
â”‚   â”œâ”€â”€ middleware/        # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ cors.ts        # CORSå¤„ç†
â”‚   â”‚   â””â”€â”€ errorHandler.ts # é”™è¯¯å¤„ç†
â”‚   â”œâ”€â”€ services/          # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ analyticsService.ts # åˆ†ææœåŠ¡
â”‚   â”‚   â”œâ”€â”€ database.ts    # æ•°æ®åº“æœåŠ¡
â”‚   â”‚   â””â”€â”€ linkService.ts # é“¾æ¥æœåŠ¡
â”‚   â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ analytics.ts   # åˆ†æå·¥å…·
â”‚   â”‚   â”œâ”€â”€ slugGenerator.ts # çŸ­ç ç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ urlValidator.ts # URLéªŒè¯
â”‚   â”‚   â””â”€â”€ validation.ts  # é€šç”¨éªŒè¯
â”‚   â”œâ”€â”€ types/             # TypeScriptç±»å‹
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ static/            # é™æ€èµ„æº
â”‚   â”‚   â””â”€â”€ dashboard.html # ç®¡ç†ç•Œé¢
â”‚   â””â”€â”€ index.ts           # ä¸»åº”ç”¨å…¥å£
â”œâ”€â”€ migrations/            # æ•°æ®åº“è¿ç§»
â”œâ”€â”€ tests/                 # æµ‹è¯•æ–‡ä»¶
â””â”€â”€ wrangler.toml         # Cloudflareé…ç½®
```

### æœ¬åœ°å¼€å‘

#### å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

#### è¿è¡Œæµ‹è¯•

```bash
npm run test
```

#### ç±»å‹æ£€æŸ¥

```bash
npm run type-check
```

#### ä»£ç æ ¼å¼åŒ–

```bash
npm run format
```

### æ•°æ®åº“ç®¡ç†

#### æœ¬åœ°æ•°æ®åº“æ“ä½œ

```bash
# æŸ¥çœ‹æ•°æ®åº“
npx wrangler d1 execute shorty-db --local --command "SELECT * FROM links LIMIT 10"

# å¤‡ä»½æ•°æ®åº“
npx wrangler d1 backup create shorty-db --local

# æ¢å¤æ•°æ®åº“
npx wrangler d1 backup restore shorty-db backup-id --local
```

#### ç”Ÿäº§æ•°æ®åº“æ“ä½œ

```bash
# æŸ¥çœ‹ç”Ÿäº§æ•°æ®
npx wrangler d1 execute shorty-db --env production --command "SELECT COUNT(*) FROM links"

# ç”Ÿäº§æ•°æ®åº“å¤‡ä»½
npx wrangler d1 backup create shorty-db --env production
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜ç­–ç•¥

- **CDN ç¼“å­˜**: é™æ€èµ„æºé€šè¿‡ Cloudflare CDN ç¼“å­˜
- **API ç¼“å­˜**: åˆ†ææ•°æ®ä½¿ç”¨é€‚å½“çš„ç¼“å­˜å¤´
- **æ•°æ®åº“ä¼˜åŒ–**: ç´¢å¼•ä¼˜åŒ–å’ŒæŸ¥è¯¢æ€§èƒ½è°ƒä¼˜

### ç›‘æ§æŒ‡æ ‡

- **å“åº”æ—¶é—´**: å¹³å‡ < 100ms
- **å¯ç”¨æ€§**: 99.9%+
- **é”™è¯¯ç‡**: < 0.1%
- **ç¼“å­˜å‘½ä¸­ç‡**: > 90%

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. **Fork é¡¹ç›®**
2. **åˆ›å»ºç‰¹æ€§åˆ†æ”¯**: `git checkout -b feature/AmazingFeature`
3. **æäº¤æ›´æ”¹**: `git commit -m 'Add some AmazingFeature'`
4. **æ¨é€åˆ†æ”¯**: `git push origin feature/AmazingFeature`
5. **åˆ›å»º Pull Request**

### ä»£ç è§„èŒƒ

- ä½¿ç”¨ TypeScript è¿›è¡Œç±»å‹å®‰å…¨
- éµå¾ª ESLint å’Œ Prettier è§„åˆ™
- ç¼–å†™å•å…ƒæµ‹è¯•
- æ›´æ–°ç›¸å…³æ–‡æ¡£

### Issue æŠ¥å‘Š

æŠ¥å‘Š Bug æˆ–æå‡ºåŠŸèƒ½è¯·æ±‚æ—¶ï¼Œè¯·æä¾›ï¼š

- è¯¦ç»†çš„é—®é¢˜æè¿°
- å¤ç°æ­¥éª¤
- æœŸæœ›è¡Œä¸º
- å®é™…è¡Œä¸º
- ç¯å¢ƒä¿¡æ¯

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäº MIT è®¸å¯è¯å¼€æº - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ™ è‡´è°¢

- [Cloudflare Workers](https://workers.cloudflare.com/) - æä¾›è¾¹ç¼˜è®¡ç®—å¹³å°
- [Hono](https://hono.dev/) - ä¼˜ç§€çš„ Web æ¡†æ¶
- [Chart.js](https://www.chartjs.org/) - æ•°æ®å¯è§†åŒ–åº“
- æ‰€æœ‰è´¡çŒ®è€…å’Œä½¿ç”¨è€…

## ğŸ“ è”ç³»æ–¹å¼

- **é¡¹ç›®ä¸»é¡µ**: https://github.com/yourusername/shorty
- **é—®é¢˜åé¦ˆ**: https://github.com/yourusername/shorty/issues
- **è®¨è®ºåŒº**: https://github.com/yourusername/shorty/discussions

---

â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª Starï¼
